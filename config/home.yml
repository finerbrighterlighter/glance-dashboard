- name: Home
  # Optionally, if you only have a single page you can hide the desktop navigation for a cleaner look
  hide-desktop-navigation: true
  center-vertically: true
  show-mobile-header: true

  columns:
    - size: small
      widgets:
        # TIME / GLOBAL CONTEXT
        - type: clock
          hour-format: 24h
          timezones:
            - timezone: Asia/Yangon
              label: Pyinmana
            - timezone: Asia/Tokyo
              label: Tokyo
            - timezone: Asia/Hong_Kong
              label: Hong Kong

        - type: server-stats
          servers:
            - type: local
              name: Fibrilinux
              hide-mountpoints-by-default: true
              mountpoints:
                "/":
                  hide: false
                  name: Root

        - type: custom-api
          title: Tailscale Devices
          title-url: https://login.tailscale.com/admin/machines
          url: https://api.tailscale.com/api/v2/tailnet/-/devices
          headers:
            Authorization: Bearer ${TAILSCALE_API_KEY}
          cache: 3m
          options:
            # collapseAfter: 4
            # disableOfflineIndicator: true
            # disableUpdateIndicator: true
            # prioritiseTags: true
          template: |
            <style>
              .device-info-container-tailscale {
                position: relative;
                overflow: hidden;
                height: 1.5em;
              }

              .device-info-tailscale {
                display: flex;
                transition: transform 0.2s ease, opacity 0.2s ease;
              }

              .device-ip-tailscale {
                position: absolute;
                top: 0;
                left: 0;
                transform: translateY(-100%);
                opacity: 0;
                transition: transform 0.2s ease, opacity 0.2s ease;
              }

              .device-info-container-tailscale:hover .device-info-tailscale {
                transform: translateY(100%);
                opacity: 0;
              }

              .device-info-container-tailscale:hover .device-ip-tailscale {
                transform: translateY(0);
                opacity: 1;
              }

              .update-indicator-tailscale {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: var(--color-primary);
                display: inline-block;
                margin-left: 4px;
                vertical-align: middle;
              }

              .offline-indicator-tailscale {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: var(--color-negative);
                display: inline-block;
                margin-left: 4px;
                vertical-align: middle;
              }

              .device-name-container-tailscale {
                display: flex;
                align-items: center;
                gap: 8px;
              }

              .indicators-container-tailscale {
                display: flex;
                align-items: center;
                gap: 4px;
              }
            </style>
            <ul class="list list-gap-10 collapsible-container" data-collapse-after="{{ .Options.IntOr "collapseAfter" 3 }}">
              {{ range .JSON.Array "devices" }}
              <li>
                <div class="flex items-center gap-10">
                  <div class="device-name-container-tailscale grow">
                    <span class="size-h4 block text-truncate color-primary">
                      {{ findMatch "^([^.]+)" (.String "name") }}
                    </span>
                    <div class="indicators-container-tailscale">
                      {{ if and (not ($.Options.BoolOr "disableUpdateIndicator" false)) (.Bool "updateAvailable") }}
                      <span class="update-indicator-tailscale" data-popover-type="text" data-popover-text="Update Available"></span>
                      {{ end }}

                      {{ if not ($.Options.BoolOr "disableOfflineIndicator" false) }}
                      {{ $lastSeen := .String "lastSeen" | parseTime "rfc3339" }}
                      {{ if not ($lastSeen.After (offsetNow "-10s")) }}
                      {{ $lastSeenTimezoned := $lastSeen.In now.Location }}
                      <span class="offline-indicator-tailscale" data-popover-type="text"
                        data-popover-text="Offline - Last seen {{ $lastSeenTimezoned.Format " Jan 2 3:04pm" }}"></span>
                      {{ end }}
                      {{ end }}

                    </div>
                  </div>
                </div>
                <div class="device-info-container-tailscale">
                  <ul class="list-horizontal-text device-info-tailscale">
                    <li>{{ .String "os" }}</li>
                    <li>
                      {{ if and ($.Options.BoolOr "prioritiseTags" false) (.Exists "tags.0") }}
                        {{ trimPrefix "tag:" (.String "tags.0") }}
                      {{ else }}
                        {{ .String "user" }}
                      {{ end }}
                    </li>
                  </ul>
                  <div class="device-ip-tailscale">
                    {{ .String "addresses.0"}}
                  </div>
                </div>
              </li>
              {{ end }}
            </ul>

        # RECENT / AGGREGATE BEHAVIOR
        - type: custom-api
          title: NextDNS Analytics
          title-url: https://api.nextdns.io/profiles/${NEXTDNS_PROFILE_ID}/analytics/status
          cache: 1h
          url: https://api.nextdns.io/profiles/${NEXTDNS_PROFILE_ID}/analytics/status
          headers:
            X-Api-Key: ${NEXTDNS_API_KEY}
          template: |
            {{ if eq .Response.StatusCode 200 }}
              <div style="display: flex; justify-content: space-between;">
                {{ $total := 0.0 }}
                {{ $blocked := 0.0 }}
                {{ range .JSON.Array "data" }}
                  {{ $total = add $total (.Int "queries" | toFloat) }}
                  {{ if eq (.String "status") "blocked" }}
                    {{ $blocked = add $blocked (.Int "queries" | toFloat) }}
                  {{ end }}
                {{ end }}
                <div style="flex: 1; text-align: center;">
                  <p>Queries</p>
                  <p>{{ printf "%.0f" $total }}</p>
                </div>
                <div style="flex: 1; text-align: center; color: var(--color-negative);">
                  <p>Blocked</p>
                  <p>{{ printf "%.0f" $blocked }}</p>
                </div>
                <div style="flex: 1; text-align: center;">
                  <p>Block Rate</p>
                  {{ if gt $total 0.0 }}
                    <p>{{ div (mul $blocked 100) $total | printf "%.2f" }}%</p>
                  {{ else }}
                    <p>0.00%</p>
                  {{ end }}
                </div>
              </div>
            {{ else }}
              <div style="text-align: center; color: var(--color-negative);">
                Error: {{ .Response.StatusCode }} - {{ .Response.Status }}
              </div>
            {{ end }}

        # FUTURE / UPCOMING CHANGE
        - type: releases
          cache: 1d
          # Without authentication the Github API allows for up to 60 requests per hour. You can create a
          # read-only token from your Github account settings and use it here to increase the limit.
          token: ${GITHUB_TOKEN}
          repositories:
            - Balackburn/Apollo
            - glanceapp/glance
            - dockerhub:stnsmith/fossflow
            - dockerhub:iib0011/omni-tools
            - dockerhub:stirlingtools/stirling-pdf

    - size: full
      widgets:
        - type: split-column
          widgets:

          - type: bookmarks
            title: " "
            groups:
              - title: Academic Presence
                color: 210 45 50   # muted sapphire-blue
                links:
                  - title: Google Scholar
                    url: https://scholar.google.com/citations?user=7waEOqcAAAAJ&hl=en
                  - title: ORCID
                    url: https://orcid.org/0000-0002-1076-9513
                  - title: Scopus
                    url: https://www.scopus.com/authid/detail.uri?authorId=57221250282
                  - title: PubMed
                    url: https://pubmed.ncbi.nlm.nih.gov/?sort=date&term=Teza+H&cauthor_id=40796195

          - type: bookmarks
            title: " "
            groups:
              - title: Professional/Work
                color: 150 45 45   # desaturated teal/green
                links:
                  - title: Portfolio
                    url: https://htunteza.com
                  - title: GitHub
                    url: https://github.com/finerbrighterlighter                
                  - title: RAMA-CEB
                    url: https://www.rama.mahidol.ac.th/ceb/
                  - title: Data Warehouse

        - type: split-column
          widgets:

          - type: bookmarks
            title: " "
            groups:
              - title: Reading
                color: 40 55 55    # soft peach/yellow
                links:
                  - title: Hacker News
                    url: https://news.ycombinator.com/
                  - title: Allkpop
                    url: https://www.allkpop.com/


          - type: bookmarks
            title: " "
            groups:
              - title: Social
                color: 350 50 50   # muted maroon/red (intentional friction)
                links:
                  - title: YouTube
                    url: https://www.youtube.com/
                  - title: Reddit
                    url: https://www.reddit.com/r/popular/
                  - title: Twitter 
                    url: https://x.com/
                  - title: Facebook
                    url: https://www.facebook.com
                    url: https://www.rama.mahidol.ac.th/ceb/CEBdatawarehouse/Overview
                  - title: Gmail
                    url: https://mail.google.com/mail/u/0/

        # 1. ACT
        - type: search
          search-engine: google
          new-tab: true
          autofocus: false
          placeholder: "Decide and act…"
          bangs:
            - title: YouTube
              shortcut: "!yt"
              url: https://www.youtube.com/results?search_query={QUERY}
            - title: GitHub
              shortcut: "!gh"
              url: https://github.com/search?q={QUERY}
            - title: Reddit
              shortcut: "!rd"
              url: https://www.reddit.com/search/?q={QUERY}
            - title: Stack Overflow
              shortcut: "!so"
              url: https://stackoverflow.com/search?q={QUERY}
            - title: "Chatgpt"
              shortcut: "!chat"
              url: https://chatgpt.com/?q={QUERY}&hints=search&model=auto
            - title: "Chatgpt (Temporary)"
              shortcut: "!chattemp"
              url: https://chatgpt.com/?q={QUERY}&hints=search&temporary-chat=true&model=auto

        # 2. Monitor

        - type: split-column
          widgets:
                
          # ENVIRONMENT / PHYSICAL CONTEXT
          - type: weather
            location: Bangkok, Thailand
            units: metric # alternatively "imperial"
            hour-format: 12h # alternatively "24h"
            # Optionally hide the location from being displayed in the widget
            hide-location: true
          
          - type: custom-api
            title: Air Quality
            cache: 10m
            url: https://api.waqi.info/feed/geo:${WAQI_LAT};${WAQI_LON}/?token=${WAQI_TOKEN}
            template: |
              {{ $aqi := printf "%03s" (.JSON.String "data.aqi") }}
              {{ $aqiraw := .JSON.String "data.aqi" }}
              {{ $updated := .JSON.String "data.time.iso" }}
              {{ $humidity := .JSON.String "data.iaqi.h.v" }}
              {{ $ozone := .JSON.String "data.iaqi.o3.v" }}
              {{ $pm25 := .JSON.String "data.iaqi.pm25.v" }}
              {{ $pressure := .JSON.String "data.iaqi.p.v" }}

              <div class="flex justify-between">
                <div class="size-h5">
                  {{ if le $aqi "050" }}
                    <div class="color-positive">Good air quality</div>
                  {{ else if le $aqi "100" }}
                    <div class="color-primary">Moderate air quality</div>
                  {{ else }}
                    <div class="color-negative">Bad air quality</div>
                  {{ end }}
                </div>
              </div>

              <div class="color-highlight size-h2">AQI: {{ $aqiraw }}</div>
              <div style="border-bottom: 1px solid; margin-block: 10px;"></div>

              <div class="margin-block-2">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">

                  <div>
                    <div class="size-h3 color-highlight">{{ $humidity }}%</div>
                    <div class="size-h6">HUMIDITY</div>
                  </div>

                  <div>
                    <div class="size-h3 color-highlight">{{ $ozone }} μg/m³</div>
                    <div class="size-h6">OZONE</div>
                  </div>

                  <div>
                    <div class="size-h3 color-highlight">{{ $pm25 }} μg/m³</div>
                    <div class="size-h6">PM2.5</div>
                  </div>

                  <div>
                    <div class="size-h3 color-highlight">{{ $pressure }} hPa</div>
                    <div class="size-h6">PRESSURE</div>
                  </div>

                </div>

                <div class="size-h6" style="margin-top: 10px;">Last Updated at {{ slice $updated 11 16 }}</div>
              </div>
                
        # 3. WATCH
        - type: group
          title: "Watch"
          widgets:
            - type: videos
              channels:
                - UCDNvRZRgvkBTUkQzFoT_8rA
                - UC3egV8AyVrnwUEOkGZB-s2Q
                - UCQ2O-iftmnlfrBuNsUUTofQ
                - UCaKod3X1Tn4c7Ci0iUKcvzQ
                - UChJof4NntaxU1VoJI8zt-Kw

        # 4. BROWSE (lowest priority)
        - type: group
          title: "Browse"
          widgets:
            - type: reddit
              subreddit: baseball
              show-thumbnails: true
              collapse-after: 3
            - type: reddit
              subreddit: koreanvariety
              show-thumbnails: true
              collapse-after: 3
            - type: reddit
              subreddit: apple
              show-thumbnails: true
              collapse-after: 3


    - size: small
      widgets:
      
        # NOW: LOCAL SYSTEM HEALTH
        - type: docker-containers
          hide-by-default: false

        - type: custom-api
          title: What's Up Docker?
          cache: 1h
          url: http://${WUD_URL}/api/containers/
          method: GET
          template: |
            {{/* You are using WUD Monitor v2.0*/}}
            <style>
              .vertical-separator {
                width: 3px;
                height: 3.5rem;
                margin: 0 1rem;
                border-radius: 2px;
                align-self: center;
                background: linear-gradient(
                  to bottom,
                  transparent,
                  rgba(255, 255, 255, 0.05) 20%,
                  rgba(255, 255, 255, 0.05) 80%,
                  transparent
                );
              }

              .container-info {
                display: flex;
                align-items: flex-start;
                justify-content: space-evenly;
                margin: 1rem 0;
                width: 100%;
              }

              .info-column {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 4rem;
              }

              .info-label {
                font-size: 1.20rem;
                opacity: 0.9;
                text-align: center;
              }

              .info-value {
                font-size: 1.4rem;
                margin-top: 0.25rem;
                text-align: center;
              }

              .info-count {
                font-size: 1.45rem !important;
              }

              /* Container Size: Full */
              @container widget (min-width: 550px) {
                .container-info {
                  justify-content: flex-start;
                  gap: 2rem;
                  padding: 0.5rem;
                }

                .vertical-separator {
                  align-self: flex-start;
                  margin: 0 2rem;
                }

                .info-column {
                  align-items: flex-start;
                }

                .info-label .info-value {
                  text-align: left;
                }
              }
            </style>

            {{/* ======================= MENU ======================= */}}
            {{ $showInfo := true }}         {{/* Show the overall info summary (Updates, Total, Running) */}}
            {{ $showList := true }}         {{/* Show the container list section */}}
            {{ $showAll := false }}         {{/* Show all containers (not just ones with updates) */}}
            {{ $showUpdateKind := true }}   {{/* Toggle this to false to hide the Update Kind row */}}
            {{ $showUpdateTypes := false }} {{/* Toggle this to false to hide the Update Types breakdown */}}
            {{ $showLocalVersion := true }} {{/* Toggle this to true to show local version instead of update status */}}
            {{ $hasUpdates := false }}      {{/* Set this to true to hide up-to-date message */}}

            {{ $containers := .JSON.Array "" }}
            {{ $total := len $containers }}
            {{ $updates := 0 }}
            {{ $running := 0 }}

            {{ range $containers }}
              {{ if .Bool "updateAvailable" }}
                {{ $updates = add $updates 1 }}
              {{ end }}
              {{ if eq (.String "status") "running" }}
                {{ $running = add $running 1 }}
              {{ end }}
            {{ end }}

            {{ if $showInfo }}
              <div class="container-info">
                <div class="info-column">
                  <div class="info-label info-count">Updates</div>
                  <div class="info-value info-count">{{ $updates }}</div>
                </div>

                <div class="vertical-separator"></div>

                <div class="info-column">
                  <div class="info-label info-count">Total</div>
                  <div class="info-value info-count">{{ $total }}</div>
                </div>

                <div class="vertical-separator"></div>

                <div class="info-column">
                  <div class="info-label info-count">Running</div>
                  <div class="info-value info-count">{{ $running }}</div>
                </div>
              </div>
              {{ if $showUpdateTypes }}
              <div class="flex items-center text-center">
                {{ $majorCount := 0 }}
                {{ $minorCount := 0 }}
                {{ $patchCount := 0 }}
                {{ $unknownCount := 0 }}
                {{ range $containers }}
                  {{ if .Bool "updateAvailable" }}
                    {{ $kind := .String "updateKind.semverDiff" }}
                    {{ if eq $kind "major" }}
                      {{ $majorCount = add $majorCount 1 }}
                    {{ else if eq $kind "minor" }}
                      {{ $minorCount = add $minorCount 1 }}
                    {{ else if eq $kind "patch" }}
                      {{ $patchCount = add $patchCount 1 }}
                    {{ else }}
                      {{ $unknownCount = add $unknownCount 1 }}
                    {{ end }}
                  {{ end }}
                {{ end }}
                <div class="flex-1">
                  <div class="size-h3">{{ $majorCount }}</div>
                  <div class="size-h6">MAJOR</div>
                </div>
                <div class="vertical-separator" style="width: 2px; margin: 0 0.25rem;"></div>
                <div class="flex-1">
                  <div class="size-h3">{{ $minorCount }}</div>
                  <div class="size-h6">MINOR</div>
                </div>
                <div class="vertical-separator" style="width: 2px; margin: 0 0.25rem;"></div>
                <div class="flex-1">
                  <div class="size-h3">{{ $patchCount }}</div>
                  <div class="size-h6">PATCH</div>
                </div>
                <div class="vertical-separator" style="width: 2px; margin: 0 0.25rem;"></div>
                <div class="flex-1">
                  <div class="size-h3">{{ $unknownCount }}</div>
                  <div class="size-h6">UNKNOWN</div>
                </div>
              </div>
              {{ end }}
            {{ end }}

            {{ if $showList }}
              <div style="height: 10px;"></div>
              <ul class="list list-gap-10 collapsible-container" data-collapse-after="3">
                {{ range $index, $container := $containers }}
                  {{ if $container.Bool "updateAvailable" }}
                    {{ $hasUpdates = true }}
                    <li>
                      <div class="flex flex-column">
                        {{ $registryName := $container.String "image.registry.name" }}
                        {{ $imageName := $container.String "image.name" }}
                        {{ $hubSource := "#" }}
                        {{ if eq $registryName "hub.public" }}
                          {{ $hubSource = concat "https://hub.docker.com/r/" $imageName }}
                        {{ else if eq $registryName "ghcr.public" }}
                          {{ $hubSource = concat "https://github.com/" $imageName }}
                        {{ end }}

                        <div class="size-h4">
                          {{ if eq ($container.String "status") "running" }}
                            <span class="status-dot color-positive">●</span>
                          {{ else }}
                            <span class="status-dot color-negative">●</span>
                          {{ end }}
                          <a class="color-highlight text-truncate" href="{{ $hubSource }}" target="_blank" rel="noreferrer">{{ $container.String "name" }}</a>
                        </div>

                        <div class="container-info">
                          <div class="info-column">
                            <div class="info-label">Watcher</div>
                            <div class="info-value">{{ $container.String "watcher" }}</div>
                          </div>

                          <div class="vertical-separator"></div>

                          {{ if $showLocalVersion }}
                            <div class="info-column">
                              <div class="info-label">Version</div>
                              <div class="info-value">
                          {{ $localValue := $container.String "updateKind.localValue" }}
                          {{ if ge (len $localValue) 7 }}
                            {{ $isSha256 := eq (slice $localValue 0 7) "sha256:" }}
                            {{ if $isSha256 }}
                              {{ $shortDigest := slice $localValue 7 11 }}
                              <span>dig: {{ $shortDigest }}</span>
                            {{ else }}
                              <span>{{ $localValue }}</span>
                            {{ end }}
                            {{ else }}
                              <span>{{ $localValue }}</span>
                            {{ end }}
                              </div>
                            </div>
                          {{ else }}
                            <div class="info-column">
                              <div class="info-label">Update</div>
                              <div class="info-value">
                                <span class="color-positive">Available</span>
                              </div>
                            </div>
                          {{ end }}
                          {{ if $showUpdateKind }}
                            <div class="vertical-separator"></div>
                            {{ $updateKind := $container.String "updateKind.semverDiff" }}
                            {{ if eq $updateKind "" }}
                              {{ $updateKind = "Unknown" }}
                            {{ end }}
                            {{ $tagValue := $container.String "updateKind.remoteValue" }}
                            {{ if eq $tagValue "" }}
                              {{ $tagValue = "Unknown" }}
                            {{ end }}
                            <div class="info-column">
                              <div class="info-label">{{ $updateKind }}</div>
                              <div class="info-value">
                                {{ if ge (len $tagValue) 7 }}
                                  {{ $isSha256 := eq (slice $tagValue 0 7) "sha256:" }}
                                  {{ if $isSha256 }}
                                    {{ $shortDigest := slice $tagValue 7 11 }}
                                    <span>dig: {{ $shortDigest }}</span>
                                  {{ else }}
                                    <span>{{ $tagValue }}</span>
                                  {{ end }}
                                  {{ else }}
                                    <span>{{ $tagValue }}</span>
                                  {{ end }}
                              </div>
                            </div>
                          {{ end }}
                        </div>
                      </div>
                    </li>
                  {{ end }}
                {{ end }}

                {{ if not $hasUpdates }}
                  <li class="flex items-center justify-center">
                    <span class="color-positive size-h4">All containers are up to date!</span>
                  </li>
                {{ end }}

                {{ if $showAll }}
                  {{ range $index, $container := $containers }}
                    {{ if not ($container.Bool "updateAvailable") }}
                      <li>
                        <div class="flex flex-column">
                          {{ $registryName := $container.String "image.registry.name" }}
                          {{ $imageName := $container.String "image.name" }}
                          {{ $hubSource := "#" }}
                          {{ if eq $registryName "hub.public" }}
                            {{ $hubSource = concat "https://hub.docker.com/r/" $imageName }}
                          {{ else if eq $registryName "ghcr.public" }}
                            {{ $hubSource = concat "https://github.com/" $imageName }}
                          {{ end }}

                          <div class="size-h4">
                            {{ if eq ($container.String "status") "running" }}
                              <span class="status-dot color-positive">●</span>
                            {{ else }}
                              <span class="status-dot color-negative">●</span>
                            {{ end }}
                            <a class="color-highlight text-truncate" href="{{ $hubSource }}" target="_blank" rel="noreferrer">{{ $container.String "name" }}</a>
                          </div>

                          <div class="container-info">
                            <div class="info-column">
                              <div class="info-label">Watcher</div>
                              <div class="info-value">{{ $container.String "watcher" }}</div>
                            </div>

                            <div class="vertical-separator"></div>

                            {{ if $showLocalVersion }}
                              <div class="info-column">
                                <div class="info-label">Version</div>
                                <div class="info-value">
                                  {{ $localValue := $container.String "updateKind.localValue" }}
                                  {{ if eq $localValue "" }}
                                    {{ $localValue = $container.String "updatekind.remoteValue" }}
                                    {{ if eq $localValue "" }}
                                      {{ $imageDigest := $container.String "image.digest.repo" }}
                                      {{ $isSha256 := eq (slice $imageDigest 0 7) "sha256:" }}
                                      {{ if $isSha256 }}
                                        {{ $shortDigest := slice $imageDigest 7 11 }}
                                        <span>dig: {{ $shortDigest }}</span>
                                      {{ else }}
                                        <span>-</span>
                                      {{ end }}
                                    {{ else }}
                                      <span>{{ $localValue }}</span>
                                    {{ end }}
                                  {{ else }}
                                    {{ $isSha256 := eq (slice $localValue 0 7) "sha256:" }}
                                    {{ if $isSha256 }}
                                      {{ $shortDigest := slice $localValue 7 11 }}
                                      <span>dig: {{ $shortDigest }}</span>
                                    {{ else }}
                                      <span>{{ $localValue }}</span>
                                    {{ end }}
                                  {{ end }}
                                </div>
                              </div>
                            {{ else }}
                              <div class="info-column">
                                <div class="info-label">Update</div>
                                <div class="info-value"><span class="color-negative">Not Found</span></div>
                              </div>
                            {{ end }}
                          </div>
                        </div>
                      </li>
                    {{ end }}
                  {{ end }}
                {{ end }}
              </ul>
            {{ end }}

        # LIVE EXTERNAL EVENTS (HIGH TEMPORAL SENSITIVITY)
        - type: custom-api
          title: MLB Today
          url: "https://statsapi.mlb.com/api/v1/schedule/games/?sportId=1&hydrate=linescore(runners),team"
          cache: 30s
          template: |
            {{ $dates := .JSON.Array "dates" }}
            {{ if eq (len $dates) 0 }}
              <div style="padding:8px;text-align:center;">No games scheduled today.</div>
            {{ else }}
              {{ $games := (index $dates 0).Array "games" }}
              {{ $wid := printf "mlb-%d" now.UnixNano }}
              <div id="{{ $wid }}" style="position:relative;padding-bottom:{{ if gt (len $games) 6 }}25px{{ else }}0px{{ end }};">
                <input type="checkbox" id="{{ $wid }}-cb" style="display:none"/>
                <ul class="visible" style="list-style:none;padding:0;margin:0;">
                  {{ $count := 0 }}
                  {{ range $i, $g := $games }}
                    {{ $abs := $g.String "status.abstractGameState" }}
                    {{ if and (lt $count 6) (eq $abs "Live") }}
                      {{ template "row" $g }}
                      {{ $count = add $count 1 }}
                    {{ end }}
                  {{ end }}
                  {{ range $i, $g := $games }}
                    {{ $abs := $g.String "status.abstractGameState" }}
                    {{ if and (lt $count 6) (eq $abs "Preview") }}
                      {{ template "row" $g }}
                      {{ $count = add $count 1 }}
                    {{ end }}
                  {{ end }}
                  {{ range $i, $g := $games }}
                    {{ $abs := $g.String "status.abstractGameState" }}
                    {{ if and (lt $count 6) (ne $abs "Live") (ne $abs "Preview") }}
                      {{ template "row" $g }}
                      {{ $count = add $count 1 }}
                    {{ end }}
                  {{ end }}
                </ul>
                <ul class="all" style="list-style:none;padding:0;margin:0;display:none">
                  {{ range $i, $g := $games }}
                    {{ if eq ($g.String "status.abstractGameState") "Live" }}
                      {{ template "row" $g }}
                    {{ end }}
                  {{ end }}
                  {{ range $i, $g := $games }}
                    {{ if eq ($g.String "status.abstractGameState") "Preview" }}
                      {{ template "row" $g }}
                    {{ end }}
                  {{ end }}
                  {{ range $i, $g := $games }}
                    {{ $abs := $g.String "status.abstractGameState" }}
                    {{ if and (ne $abs "Live") (ne $abs "Preview") }}
                      {{ template "row" $g }}
                    {{ end }}
                  {{ end }}
                </ul>
                {{ if gt (len $games) 6 }}
                  <label for="{{ $wid }}-cb" style="position:absolute;bottom:0px;right:0;cursor:pointer;color:var(--glance-accent-color);font-size:16px;padding:5px;">
                    <span style="display:inline-block;transition:transform .2s;font-size:20px;">&#9662;</span>
                  </label>
                {{ end }}
                <style>
                  #{{ $wid }}-cb:not(:checked) ~ .all  { display:none!important }
                  #{{ $wid }}-cb:checked   ~ .visible { display:none!important }
                  #{{ $wid }}-cb:checked   ~ .all     { display:block!important }
                  #{{ $wid }}-cb:checked   ~ label span { transform:rotate(180deg)!important }
                </style>
              </div>
            {{ end }}
            {{ define "row" }}
              {{/* --- AWAY SIDE --- */}}
              {{ $awayAbr  := .String "teams.away.team.abbreviation" }}
              {{ $awayCode := .String "teams.away.team.fileCode" }}
              {{ $awayRecW := .Int    "teams.away.leagueRecord.wins" }}
              {{ $awayRecL := .Int    "teams.away.leagueRecord.losses" }}
              {{ $awaySc   := .Int    "teams.away.score" }}
              {{ $awayId   := .Int    "teams.away.team.id" }}
              {{/* --- HOME SIDE --- */}}
              {{ $homeAbr  := .String "teams.home.team.abbreviation" }}
              {{ $homeCode := .String "teams.home.team.fileCode" }}
              {{ $homeRecW := .Int    "teams.home.leagueRecord.wins" }}
              {{ $homeRecL := .Int    "teams.home.leagueRecord.losses" }}
              {{ $homeSc   := .Int    "teams.home.score" }}
              {{ $homeId   := .Int    "teams.home.team.id" }}
              {{/* status & linescore */}}
              {{ $abs             := .String "status.abstractGameState" }}
              {{ $detailed        := .String "status.detailedState" }}
              {{ $live            := eq $abs "Live" }}
              {{ $inningSt        := .String "linescore.inningState" }}
              {{ $inningN         := .Int    "linescore.currentInning" }}
              {{ $seriesDesc      := .String "seriesDescription" }}
              {{ $seriesLabel     := .String "description" }}
              {{ $seriesGame      := .Int    "seriesGameNumber" }}
              {{ $isRegularSeries := or (eq $seriesDesc "Regular Season") (eq $seriesDesc "Regular Season 1") (eq $seriesDesc "Regular Season 2") (eq $seriesDesc "Regular Season 3") (eq $seriesDesc "Regular Season 4") }}
              {{ $isPlayoffSeries := and (ne $seriesDesc "") (not $isRegularSeries) }}
              {{/* offense & base occupancy */}}
              {{ $r1        := .Exists "linescore.offense.first" }}
              {{ $r2        := .Exists "linescore.offense.second" }}
              {{ $r3        := .Exists "linescore.offense.third" }}
              {{ $offTeamId := .Int    "linescore.offense.team.id" }}
              <li style="display:flex;flex-direction:column;gap:6px;padding:8px 0;border-bottom:1px solid var(--glance-divider);white-space:normal;"
                  {{ if ne $abs "Preview" }}
                    title="{{ $awayAbr }} Box:{{ range $i, $inning := (.Array "linescore.innings") }}
                      {{ if lt $i 9 }}  Inning {{ add $i 1 }}: {{ $inning.Int "away.runs" }}{{ else }}  Inning {{ add $i 1 }}: {{ $inning.Int "away.runs" }}{{ end }}
                    {{ end }}&#10;{{ $homeAbr }} Box:{{ range $i, $inning := (.Array "linescore.innings") }}
                      {{ if lt $i 9 }}  Inning {{ add $i 1 }}: {{ $inning.Int "home.runs" }}{{ else }}  Inning {{ add $i 1 }}: {{ $inning.Int "home.runs" }}{{ end }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {{ end }}"
                  {{ end }}>
                <div style="display:flex;align-items:center;gap:12px;">
                  <span style="display:flex;align-items:center;width:80px;white-space:nowrap;">
                    <img src='{{ if eq $awayCode "ana" }}https://a.espncdn.com/combiner/i?img=/i/teamlogos/mlb/500/laa.png&h=24&w=24{{ else }}https://a.espncdn.com/combiner/i?img=/i/teamlogos/mlb/500/{{ $awayCode }}.png&h=24&w=24{{ end }}'
                        alt='{{ $awayAbr }}'
                        style='width:24px;height:24px;margin-right:4px;'/>
                    <span style="display:flex;flex-direction:column;margin-right:4px;">
                      <span style="font-weight:bold;">{{ $awayAbr }}</span>
                      <span style="font-size:0.7em;color:var(--glance-muted-text)">
                        ({{ printf "%d-%d" $awayRecW $awayRecL }})
                      </span>
                    </span>
                    {{ if ne $abs "Preview" }}
                      <span style="margin-left:auto;font-size:1em;font-weight:700;font-variant-numeric:tabular-nums;color:var(--glance-heading-text);">{{ $awaySc }}</span>
                    {{ end }}
                    {{ if and $live (eq $offTeamId $awayId) }}
                      <svg width="20" height="20" viewBox="0 0 24 24" style="margin-left:4px;flex-shrink:0;">
                        <rect x="6" y="6" width="12" height="12" fill="#808080" transform="rotate(45 12 12)"/>
                        {{ if $r1 }}<circle cx="17" cy="12" r="2.5" fill="white"/>{{ end }}
                        {{ if $r2 }}<circle cx="12" cy="7" r="2.5" fill="white"/>{{ end }}
                        {{ if $r3 }}<circle cx="7" cy="12" r="2.5" fill="white"/>{{ end }}
                      </svg>
                    {{ end }}
                  </span>
                <span style="text-align:center;width:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;font-size:0.9em;white-space:nowrap;">
                  {{ if eq $abs "Preview" }}
                    {{ $gameTime := (.String "gameDate" | parseTime "2006-01-02T15:04:05Z").In now.Location }}
                    <span style="color:var(--glance-muted-text)">{{ printf "%02d:%02d" $gameTime.Hour $gameTime.Minute }}</span>
                  {{ else if $live }}
                    <span style="font-weight:500;">{{ printf "%s %d" $inningSt $inningN }}</span>
                  {{ else if or (eq $detailed "Game Over") (eq $detailed "Final") }}
                    <span style="font-size:1.1em;font-weight:500;">Final</span>
                  {{ else }}
                    <span>{{ $detailed }}</span>
                  {{ end }}
                  {{ if $isPlayoffSeries }}
                    <span style="font-size:0.9em;color:var(--glance-accent-color);margin-top:0;">
                      {{ if $seriesLabel }}
                        {{ $seriesLabel }}
                      {{ else if gt $seriesGame 0 }}
                        {{ printf "%s (Game %d)" $seriesDesc $seriesGame }}
                      {{ else }}
                        {{ $seriesDesc }}
                      {{ end }}
                    </span>
                  {{ end }}
                </span>
                  <span style="display:flex;align-items:center;width:80px;justify-content:flex-end;white-space:nowrap;">
                    {{ if and $live (eq $offTeamId $homeId) }}
                      <svg width="20" height="20" viewBox="0 0 24 24" style="margin-right:4px;flex-shrink:0;">
                        <rect x="6" y="6" width="12" height="12" fill="#808080" transform="rotate(45 12 12)"/>
                        {{ if $r1 }}<circle cx="17" cy="12" r="2.5" fill="white"/>{{ end }}
                        {{ if $r2 }}<circle cx="12" cy="7" r="2.5" fill="white"/>{{ end }}
                        {{ if $r3 }}<circle cx="7" cy="12" r="2.5" fill="white"/>{{ end }}
                      </svg>
                    {{ end }}
                    {{ if ne $abs "Preview" }}
                      <span style="margin-left:auto;font-size:1em;font-weight:700;font-variant-numeric:tabular-nums;color:var(--glance-heading-text);">{{ $homeSc }}</span>
                    {{ end }}
                    <span style="display:flex;flex-direction:column;margin-left:4px;text-align:right;">
                      <span style="font-weight:bold;">{{ $homeAbr }}</span>
                      <span style="font-size:0.7em;color:var(--glance-muted-text)">
                        ({{ printf "%d-%d" $homeRecW $homeRecL }})
                      </span>
                    </span>
                    <img src='{{ if eq $homeCode "ana" }}https://a.espncdn.com/combiner/i?img=/i/teamlogos/mlb/500/laa.png&h=24&w=24{{ else }}https://a.espncdn.com/combiner/i?img=/i/teamlogos/mlb/500/{{ $homeCode }}.png&h=24&w=24{{ end }}'
                        alt='{{ $homeAbr }}'
                        style='width:24px;height:24px;margin-left:4px;'/>
                  </span>
                </div>
              </li>
            {{ end }}

        # PERSONAL HISTORY / MOOD (LOWER URGENCY)
        - type: custom-api
          title: Last.fm
          cache: 2m
          url: http://ws.audioscrobbler.com/2.0/
          parameters:
            method: user.getRecentTracks
            user: ${LASTFM_USERNAME}
            api_key: ${LASTFM_API_KEY}
            format: json
            limit: 10
          template: |
            <ul class="list list-gap-10 collapsible-container" data-collapse-after="5">
              {{ range .JSON.Array "recenttracks.track" }}
                <li class="flex items-center gap-10">
                  <div style="border-radius: 5px; min-width: 5rem; max-width: 5rem; overflow: hidden;" class="card">
                    <object data={{ .String "image.2.#text" }} type="image/png">
                      <img src="https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png" alt="Fallback">
                    </object>
                  </div>
                  <div class="flex-1">
                    <p class="color-positive size-h5">{{ .String "artist.#text" }}</p>
                    <p class="size-h5">{{ .String "name" }}</p>
                    <p class="size-h6">
                      {{ if .String "@attr.nowplaying" }}
                        <span class="color-positive">Now playing</span>
                      {{ else }}
                        <span class="color-subdue" {{ .String "date.#text" | parseRelativeTime "02 Jan 2006, 15:04" }}></span>
                      {{ end }}
                    </p>
                  </div>
                </li>
              {{ end }}
            </ul>

        - type: custom-api
          title: Trakt
          cache: 1h
          url: https://api.trakt.tv/users/${TRAKT_USERNAME}/history
          parameters:
            type: shows,movies
            limit: 10
            sort: watched_at,desc
          headers:
            trakt-api-key: ${TRAKT_API_KEY}
            trakt-api-version: 2
            User-Agent: GlanceWidget
            Accept: application/json
          template: |
            {{/* USER VARIABLES BEGIN */}}
            {{/* Number of items to show before SHOW MORE appears */}}
            {{ $collapseAfter := 3 }}

            {{/* Set to false to hide S#E# episode numbers on TV Shows */}}
            {{ $showEpisodeNumber := true }}

            {{/* Set to true to show year on Movies */}}
            {{ $showMovieYear := false }}

            {{/* Set to true to show year on TV Shows */}}
            {{ $showTVYear := false }}
            {{/* USER VARIABLES END */}}

            <ul class="list list-gap-10 collapsible-container" data-collapse-after="{{ $collapseAfter }}">
            {{ range .JSON.Array "" }}
              {{ $tmdbID := "" }}
              {{ $tmdbData := "" }}
              {{ $mediaType := .String "type" }}
              {{ $tmdbPageUrl := "" }}
              {{ $imageUrlBase := "https://image.tmdb.org/t/p/w185" }}
              {{ $posterPath := "" }}
              {{ $posterUrl := "" }}
              {{ if eq $mediaType "episode" }}
                {{ $tmdbID = .String "show.ids.tmdb" }}
                {{
                  $tmdbData = newRequest (concat "https://api.themoviedb.org/3/tv/" $tmdbID "?api_key=" "${TMDB_API_KEY}")
                  | withHeader "Accept" "application/json"
                  | getResponse
                }}
                {{ $tmdbPageUrl = concat "https://www.themoviedb.org/tv/" $tmdbID }}
              {{ else }}
                {{ $tmdbID = .String "movie.ids.tmdb" }}
                {{
                  $tmdbData = newRequest (concat "https://api.themoviedb.org/3/movie/" $tmdbID "?api_key=" "${TMDB_API_KEY}")
                  | withHeader "Accept" "application/json"
                  | getResponse
                }}
                {{ $tmdbPageUrl = concat "https://www.themoviedb.org/movie/" $tmdbID }}
              {{ end }}
              {{ if $tmdbData }}
                {{ $posterPath = $tmdbData.JSON.String "poster_path" }}
                {{ if $posterPath }}
                  {{ $posterUrl = concat $imageUrlBase $posterPath }}
                {{ end }}
              {{ end }}

              <li class="flex items-center gap-10">
                <a href={{ $tmdbPageUrl }} target="_blank">
                  <img src='{{ $posterUrl }}' alt="" style="border-radius: 5px; min-width: 5rem; max-width: 5rem;" class="card">
                </a>
                <div class="flex-1">
                  <a href={{ $tmdbPageUrl }} target="_blank">
                    <p class="color-positive size-h5">{{ .String "show.title" }}{{ .String "movie.title" }}
                    {{ if eq (.String "type") "movie" }}
                      {{ if $showMovieYear }}
                        ({{ .String "movie.year" }})
                      {{ end }}
                    {{ else }}
                      {{ if $showTVYear }}
                        ({{ .String "show.year" }})
                      {{ end }}
                    {{ end }}
                    </p>
                  </a>
                  <a href={{ $tmdbPageUrl }} target="_blank">
                    {{ if eq (.String "type") "episode" }}
                    <p class="size-h5">
                    {{ if $showEpisodeNumber }}
                      (S{{ .String "episode.season" }}E{{ .String "episode.number" }}) 
                    {{ end }}
                    {{ .String "episode.title" }}
                    </p>
                    {{ end }}
                  </a>
                  <p class="size-h6">
                    <span class="color-subdue" {{ .String "watched_at" | parseRelativeTime "2006-01-02T15:04:05.000Z" }}></span>
                  </p>
                </div>
              </li>
            {{ end }}
            </ul>

        # AMBIENT / DELIGHT (INTENTIONALLY LAST)
        - type: custom-api
          title: xkcd
          cache: 12h
          url: https://xkcd.com/info.0.json
          template: | 
            <body> {{ .JSON.String "title" }}</body>
            <img src="{{ .JSON.String "img" }}"></img>
